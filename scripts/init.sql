GRANT TEMP ON DATABASE commerce TO yummy;
GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO yummy;
GRANT EXECUTE ON ALL FUNCTIONS IN SCHEMA public TO yummy;
GRANT USAGE ON ALL SEQUENCES IN SCHEMA public TO yummy;

\c commerce;

CREATE TABLE products (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL,
  price DECIMAL(12,2) NOT NULL CHECK (price > 0)
);


CREATE INDEX product_name_idx ON products(name);

CREATE TABLE categories (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL
);

CREATE TABLE product_category (
  product_id INT REFERENCES products(id) ON DELETE CASCADE,
  category_id INT REFERENCES categories(id) ON DELETE CASCADE, 
  PRIMARY KEY (product_id, category_id)
);

CREATE TABLE roles (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL
);

CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL,
  surname TEXT NOT NULL,
  email TEXT NOT NULL,
  password_hash TEXT NOT NULL,
  role_id INT REFERENCES roles(id),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL
);

CREATE TABLE purchases (
  id SERIAL PRIMARY KEY,
  user_id INT REFERENCES users(id),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL
);

CREATE TABLE purchase_product (
  purchase_id INT REFERENCES purchases(id),
  product_id INT REFERENCES products(id),
  count INT NOT NULL CHECK(count > 0),
  price_per_item DECIMAL(12, 2) NOT NULL CHECK(price_per_item > 0),
  PRIMARY KEY (purchase_id, product_id)
);

-- Data --
INSERT INTO categories (name) VALUES ('Electronics'), ('Books'), ('Clothing'), ('Home & Kitchen'), ('Sports & Outdoors'), ('Beauty & Personal Care'), ('Toys & Games'), ('Automotive'), ('Health & Household'), ('Grocery & Gourmet Food');

INSERT INTO products (name, price) VALUES ('Ergonomic Cotton Car', 141.08),
('Licensed Wooden Gloves', 35.03),
('Sleek Plastic Towels', 81.86),
('Awesome Bronze Sausages', 188.59),
('Handcrafted Cotton Gloves', 89.79),
('Unbranded Steel Keyboard', 164.63),
('Rustic Frozen Pants', 66.5),
('Handmade Concrete Hat', 168.08),
('Elegant Frozen Towels', 116.06),
('Generic Concrete Car', 171.45),
('Awesome Frozen Chips', 158.36),
('Modern Plastic Cheese', 111.53),
('Generic Fresh Gloves', 122.83),
('Gorgeous Plastic Chicken', 161.73),
('Oriental Soft Shoes', 82.25),
('Intelligent Steel Bike', 88.24),
('Handcrafted Metal Sausages', 115.64),
('Modern Soft Hat', 124.15),
('Refined Frozen Sausages', 37.23),
('Intelligent Cotton Car', 172.61),
('Modern Metal Chair', 184.64),
('Recycled Soft Chips', 191.45),
('Small Plastic Bacon', 51.03),
('Luxurious Soft Shirt', 13.33),
('Handcrafted Wooden Fish', 148.42),
('Electronic Granite Table', 188.15),
('Gorgeous Bronze Car', 88.83),
('Small Rubber Salad', 143.78),
('Licensed Cotton Table', 37.05),
('Rustic Cotton Keyboard', 53.11),
('Incredible Granite Salad', 73.3),
('Small Cotton Shoes', 203.75),
('Rustic Cotton Hat', 158.22),
('Unbranded Frozen Cheese', 99.3),
('Generic Concrete Cheese', 51.39),
('Tasty Granite Bike', 108.23),
('Modern Fresh Bike', 62.11),
('Awesome Soft Computer', 152.95),
('Refined Rubber Chicken', 133.64),
('Ergonomic Concrete Pants', 75.9);

INSERT INTO product_category (product_id, category_id) VALUES (1, 8),
(2, 8),
(2, 9),
(3, 3),
(3, 1),
(4, 5),
(4, 10),
(5, 5),
(5, 10),
(6, 7),
(7, 6),
(8, 5),
(8, 4),
(9, 1),
(9, 4),
(10, 3),
(11, 7),
(11, 8),
(12, 6),
(13, 5),
(14, 7),
(14, 1),
(15, 7),
(15, 1),
(16, 5),
(16, 9),
(17, 3),
(17, 5),
(18, 4),
(18, 2),
(19, 7),
(20, 9),
(21, 4),
(22, 1),
(22, 7),
(23, 2),
(24, 5),
(25, 6),
(26, 3),
(27, 6),
(28, 6),
(29, 4),
(29, 8),
(30, 4),
(30, 1),
(31, 4),
(32, 10),
(32, 9),
(33, 4),
(34, 4),
(35, 7),
(35, 2),
(36, 5),
(36, 8),
(37, 10),
(38, 1),
(39, 3),
(40, 4),
(40, 1);

INSERT INTO roles (name) VALUES ('admin'), ('user');

INSERT INTO users (name, surname, email, password_hash, role_id) VALUES ('Yummy', 'Yummiech', 'yummy.yummiech@yummy.com', '$2b$10$NeytV7.0QqSvWqOxqJqeMeZ7yZEWdH9LDQBFrndV3FClIbOgPmzLG', 1),
('Olddy', 'Spicy', 'olddy.spicy@yummy.com', '$2b$10$NeytV7.0QqSvWqOxqJqeMevEvyEeyuexa2tHdLnPwBvkS8I20PrXu', 2),
('Ephraim', 'Haag', 'Ephraim.Haag99@gmail.com', '$2b$10$NeytV7.0QqSvWqOxqJqeMencT.r1KFgBsyVEtTGVPvjUqAsXnbhdC', 1),
('Maci', 'Koelpin', 'Maci.Koelpin@yahoo.com', '$2b$10$NeytV7.0QqSvWqOxqJqeMencT.r1KFgBsyVEtTGVPvjUqAsXnbhdC', 1);

INSERT INTO purchases (user_id) VALUES (3),
(3),
(3),
(2),
(2),
(2),
(2),
(3),
(3),
(2),
(2),
(2),
(2),
(3),
(2),
(2),
(2),
(2),
(3),
(3);

INSERT INTO purchase_product (purchase_id, product_id, count, price_per_item) VALUES (1, 3, 2, 81.86),
(1, 12, 3, 111.53),
(1, 15, 5, 82.25),
(1, 26, 2, 188.15),
(1, 37, 2, 62.11),
(1, 34, 5, 99.3),
(1, 35, 3, 51.39),
(1, 17, 2, 115.64),
(1, 8, 3, 168.08),
(1, 32, 5, 203.75),
(2, 34, 2, 99.3),
(2, 6, 2, 164.63),
(2, 20, 1, 172.61),
(2, 37, 4, 62.11),
(2, 7, 2, 66.5),
(2, 38, 5, 152.95),
(2, 27, 1, 88.83),
(2, 5, 1, 89.79),
(3, 38, 5, 152.95),
(3, 7, 5, 66.5),
(3, 12, 1, 111.53),
(3, 8, 1, 168.08),
(3, 13, 1, 122.83),
(4, 16, 3, 88.24),
(4, 33, 5, 158.22),
(4, 2, 2, 35.03),
(4, 36, 2, 108.23),
(4, 26, 2, 188.15),
(4, 9, 4, 116.06),
(4, 24, 4, 13.33),
(4, 28, 5, 143.78),
(5, 20, 4, 172.61),
(5, 30, 3, 53.11),
(5, 3, 4, 81.86),
(5, 40, 5, 75.9),
(5, 17, 4, 115.64),
(6, 22, 2, 191.45),
(6, 12, 1, 111.53),
(6, 20, 2, 172.61),
(6, 36, 1, 108.23),
(7, 26, 3, 188.15),
(7, 36, 4, 108.23),
(7, 15, 3, 82.25),
(8, 40, 4, 75.9),
(8, 10, 2, 171.45),
(8, 23, 4, 51.03),
(9, 3, 4, 81.86),
(9, 38, 1, 152.95),
(9, 31, 4, 73.3),
(9, 4, 2, 188.59),
(9, 1, 1, 141.08),
(9, 18, 4, 124.15),
(9, 8, 5, 168.08),
(9, 2, 2, 35.03),
(9, 40, 4, 75.9),
(9, 9, 2, 116.06),
(10, 20, 1, 172.61),
(10, 25, 4, 148.42),
(10, 28, 1, 143.78),
(10, 5, 1, 89.79),
(10, 23, 5, 51.03),
(10, 3, 2, 81.86),
(11, 18, 1, 124.15),
(11, 36, 4, 108.23),
(12, 13, 1, 122.83),
(12, 16, 2, 88.24),
(12, 11, 5, 158.36),
(13, 22, 5, 191.45),
(13, 18, 5, 124.15),
(13, 14, 4, 161.73),
(13, 29, 1, 37.05),
(13, 4, 5, 188.59),
(13, 35, 3, 51.39),
(13, 10, 2, 171.45),
(13, 25, 4, 148.42),
(14, 29, 4, 37.05),
(14, 9, 2, 116.06),
(15, 11, 2, 158.36),
(15, 20, 1, 172.61),
(15, 27, 1, 88.83),
(15, 35, 1, 51.39),
(15, 4, 5, 188.59),
(16, 9, 4, 116.06),
(16, 5, 5, 89.79),
(16, 39, 2, 133.64),
(16, 32, 5, 203.75),
(16, 19, 3, 37.23),
(17, 27, 2, 88.83),
(17, 23, 5, 51.03),
(17, 1, 3, 141.08),
(17, 33, 2, 158.22),
(18, 12, 1, 111.53),
(19, 29, 2, 37.05),
(19, 14, 5, 161.73),
(20, 27, 5, 88.83),
(20, 36, 2, 108.23),
(20, 28, 5, 143.78);
